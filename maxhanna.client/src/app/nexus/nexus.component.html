<div class=componentMain>
  <div class="closeButton" (click)="remove_me('NexusComponent');"></div>
  <div class="refreshButton" (click)="ngOnInit();"></div>
  <div class="componentTitle">Bug Wars</div>


  <div *ngIf="!isUserComponentOpen && parentRef && parentRef.user && isUserNew">
    Welcome to Nexus wars.
    <button (click)="start()">Enter the fight</button>
  </div>

  <div class="gamescreen" [style.display]="!isUserNew ? 'block':'none'">
    <div [style.display]="numberOfPersonalBases > 1 && !isReportsOpen && !isSupportOpen && !isBasesOpen && nexusBase ? 'block' : 'none'">
      <button class="previousBaseButton" (click)="previousBase()" [disabled]="isLoading">‚©§</button>
      <button class="nextBaseButton" (click)="nextBase()" [disabled]="isLoading">‚©•</button>
    </div>
    <div *ngIf="!isReportsOpen && !isMapOpen && !isBasesOpen && !isSupportOpen && !isUserNew && nexusBase" class="resourceDiv">
      <span title="Gold" class="resourceSpan">ü™ô:{{ (nexusBase && nexusBase.gold ? nexusBase.gold : '0') | number:'1.0-2' }}</span>
      <span title="Supply Capacity" class="resourceSpan" *ngIf="nexusBase">ü•©:{{calculateCurrentSupply()}}</span>
      <span title="Nexus location" class="resourceSpan" *ngIf="nexusBase">üìç:<span class="invertedHighlights">{{'{' + nexusBase.coordsX + ',' + nexusBase.coordsY + '}'}}</span></span>
    </div>

    <div *ngIf="parentRef && parentRef.user"
         [style.display]="isReportsOpen && !isMinesOpen && !isCommandCenterOpen && !isSupplyDepotOpen && !isFactoryOpen
         && !isMinesOpen && !isStarportOpen && !isWarehouseOpen && !isEngineeringBayOpen && !isMapOpen && !isBasesOpen && nexusBase ? 'block' : 'none'"
         class="battleReportComponentDiv">
      <app-nexus-reports
        [targetBase]="nexusBase"
        [user]="parentRef.user" 
        (openMapEmitter)="emittedOpenMapAndScrollTo($event)"
        *ngIf="isReportsOpen"> 
      </app-nexus-reports>
    </div>

    <div class="mapComponentDiv" #mapComponentDiv *ngIf="parentRef && parentRef.user" [style.display]="isMapOpen ? 'block':'none'">
      <app-nexus-map #mapComponent
                     [user]="parentRef.user"
                     [inputtedParentRef]="parentRef"
                     [nexusBase]="nexusBase"
                     [nexusAvailableUnits]="nexusAvailableUnits"
                     [nexusUnitsOutsideOfBase]="nexusUnitsOutsideOfBase"
                     [unitStats]="units"
                     [lvl1Src]="nexusLevel1Src"
                     [lvl2Src]="nexusLevel2Src"
                     [lvl3Src]="nexusLevel3Src"
                     [marinePictureSrc]="marinePictureSrc"
                     [goliathPictureSrc]="goliathPictureSrc"
                     [siegeTankPictureSrc]="siegeTankPictureSrc"
                     [scoutPictureSrc]="scoutPictureSrc"
                     [wraithPictureSrc]="wraithPictureSrc"
                     [battlecruiserPictureSrc]="battlecruiserPictureSrc"
                     [glitcherPictureSrc]="glitcherPictureSrc"
                     [mapTileSrc]="mapTileSrc"
                     [mapTileSrc2]="mapTileSrc2"
                     [mapTileSrc3]="mapTileSrc3"
                     [nexusAttacksSent]="nexusAttacksSent"
                     [nexusDefencesSent]="nexusDefencesSent"
                     [nexusAttacksIncoming]="nexusAttacksIncoming"
                     [nexusDefencesIncoming]="nexusDefencesIncoming"
                     [attackTimers]="attackTimers"
                     [defenceTimers]="defenceTimers"
                     (emittedNotifications)="emittedNotifications($event)"
                     (emittedReloadEvent)="emittedReloadEvent($event)"
                     (closeMapEvent)="viewMap()"
                     (emittedAttackEvent)="emittedAttackEvent($event)"
                     (emittedGoToBaseEvent)="emittedGoToBaseEvent($event)">
      </app-nexus-map>
    </div>


    <app-nexus-bases class="baseListComponentDiv" *ngIf="parentRef && parentRef.user && mapData && nexusBase"
                     [style.display]="isBasesOpen ? 'block':'none'"
                     [mapData]="mapData"
                     [nexusBase]="nexusBase"
                     [user]="parentRef.user"
                     [attacksIncoming]="nexusAttacksIncoming"
                     (emittedBaseChange)="emittedBaseChange($event)"
                     (emittedNotifications)="emittedNotifications($event)">
    </app-nexus-bases>

    <app-nexus-support-screen *ngIf="parentRef && parentRef.user && nexusBase"
                              class="baseListComponentDiv"
                              [style.display]="isSupportOpen ? 'block':'none'"
                              [user]="parentRef.user"
                              [inputtedParentRef]="parentRef"
                              [nexusDefencesIncoming]="nexusDefencesIncoming"
                              [nexusDefencesSent]="nexusDefencesSent"
                              (defenceReturnedEmitter)="emittedDefenceReturned($event)"
                              (openMapEmitter)="emittedOpenMapAndScrollTo($event)"></app-nexus-support-screen>



    <img [src]="nexusBackgroundPictureSrc"
         class="nexusBackground"
         *ngIf="nexusBackgroundPictureSrc"
         [style.display]="!isMinesOpen && !isWarehouseOpen && !isEngineeringBayOpen && !isCommandCenterOpen && !isSupplyDepotOpen
         && !isFactoryOpen && !isMinesOpen && !isStarportOpen && !isMapOpen && !isBasesOpen && !isReportsOpen && !isSupportOpen ? 'block' : 'none' "
         loading="lazy" decoding="asynchronous" />


    <div [style.display]="!isMinesOpen && !isCommandCenterOpen && !isSupplyDepotOpen && !isFactoryOpen && !isMinesOpen
         && !isStarportOpen && !isWarehouseOpen && !isEngineeringBayOpen && !isMapOpen && !isBasesOpen && !isReportsOpen && !isSupportOpen && nexusBase ? 'block' : 'none'">
      <div class="building">
        <img [src]="(nexusBase.commandCenterLevel > 4 ? cclvl3Src : nexusBase.commandCenterLevel > 2 ? cclvl2Src : cclvl1Src)" class="commandCenter buildingPicture" *ngIf="nexusBase && cclvl1Src && cclvl2Src && cclvl3Src" (click)="openCommandCenter()" title="Command Center" loading="lazy" decoding="asynchronous" />
        <span class="levelLabel commandCenterLevelDisplay" *ngIf="nexusBase">
          {{nexusBase.commandCenterLevel ? nexusBase.commandCenterLevel : ''}}
          <span class="timerLabel">
            {{getBuildingTimerForBuilding("command_center") ? formatTimer(getBuildingTimerForBuilding("command_center").endTime) : ''}}
          </span>
        </span>
      </div>

      <div class="building" [style.display]="displayMines ?  'block' : 'none'">
        <img [src]="nexusBase.minesLevel < 3 ? mineslvl1Src : nexusBase.minesLevel < 4 ? mineslvl2Src : mineslvl3Src"
             class="buildingPicture mines"
             *ngIf="nexusBase && mineslvl1Src && mineslvl2Src && mineslvl3Src" (click)="openMines();" title="Mines" loading="lazy" decoding="asynchronous" />
        <span class="levelLabel minesLevelDisplay" *ngIf="nexusBase">
          {{nexusBase.minesLevel ? nexusBase.minesLevel : ''}}
          <span class="timerLabel">
            {{getBuildingTimerForBuilding("mines") ? formatTimer(getBuildingTimerForBuilding("mines").endTime) : ''}}
          </span>
        </span>
      </div>


      <div class="building" [style.visibility]="displayEngineeringBay ?  'visible' : 'hidden'">
        <img [src]="nexusBase.engineeringBayLevel < 3 ? eblvl1Src : nexusBase.engineeringBayLevel < 4 ? eblvl2Src : eblvl3Src"
             class="buildingPicture engineeringBay"
             *ngIf="nexusBase && eblvl1Src && eblvl2Src && eblvl3Src" (click)="openEngineeringBay();" title="Engineering Bay" loading="lazy" decoding="asynchronous" />
        <span class="levelLabel engineeringBayLevelDisplay" *ngIf="nexusBase">
          {{nexusBase.engineeringBayLevel ? nexusBase.engineeringBayLevel : ''}}
          <span class="timerLabel">
            {{getBuildingTimerForBuilding("engineering_bay") ? formatTimer(getBuildingTimerForBuilding("engineering_bay").endTime) : ''}}
          </span>
        </span>
      </div>


      <div class="building" [style.visibility]="displayWarehouse ?  'visible' : 'hidden'">
        <img [src]="nexusBase.warehouseLevel < 3 ? whlvl1Src : nexusBase.warehouseLevel < 4 ? whlvl2Src : whlvl3Src"
             class="buildingPicture warehouse"
             *ngIf="nexusBase && whlvl1Src && whlvl2Src && whlvl3Src" (click)="openWarehouse();" title="Warehouse" loading="lazy" decoding="asynchronous" />
        <span class="levelLabel warehouseLevelDisplay" *ngIf="nexusBase">
          {{nexusBase.warehouseLevel ? nexusBase.warehouseLevel : ''}}
          <span class="timerLabel">
            {{getBuildingTimerForBuilding("warehouse") ? formatTimer(getBuildingTimerForBuilding("warehouse").endTime) : ''}}
          </span>
        </span>
      </div>

      <div class="building" [style.visibility]="displayFactory ?  'visible' : 'hidden'">
        <img [src]="nexusBase.factoryLevel < 3 ? flvl1Src : nexusBase.factoryLevel < 4 ? flvl2Src : flvl3Src"
             class="buildingPicture factory"
             *ngIf="nexusBase && flvl1Src && flvl2Src && flvl3Src" (click)="openFactory()" title="Factory" loading="lazy" decoding="asynchronous" />
        <span class="levelLabel factoryLevelDisplay" *ngIf="nexusBase">
          {{nexusBase.factoryLevel ? nexusBase.factoryLevel : ''}}
          <span class="timerLabel">
            {{getBuildingTimerForBuilding("factory") ? formatTimer(getBuildingTimerForBuilding("factory").endTime) : ''}}
          </span>
        </span>
      </div>

      <div class="building" [style.visibility]="displayStarport ?  'visible' : 'hidden'">
        <img [src]="nexusBase.starportLevel < 3 ? splvl1Src : nexusBase.starportLevel < 4 ? splvl2Src : splvl3Src"
             class="buildingPicture starport"
             *ngIf="nexusBase && splvl1Src && splvl2Src && splvl3Src" (click)="openStarport()" title="Starport" loading="lazy" decoding="asynchronous" />
        <span class="levelLabel starportLevelDisplay" *ngIf="nexusBase">
          {{nexusBase.starportLevel ? nexusBase.starportLevel : ''}}
          <span class="timerLabel">
            {{getBuildingTimerForBuilding("starport") ? formatTimer(getBuildingTimerForBuilding("starport").endTime) : ''}}
          </span>
        </span>
      </div>

      <div class="building" [style.visibility]="displaySupplyDepot ? 'visible' : 'hidden'">
        <img [src]="nexusBase.supplyDepotLevel < 3 ? sdlvl1Src : nexusBase.supplyDepotLevel < 4 ? sdlvl2Src : sdlvl3Src"
             class="buildingPicture supplyDepot"
             *ngIf="nexusBase && sdlvl1Src && sdlvl2Src && sdlvl3Src" (click)="openSupplyDepot()" title="Supply Depot" loading="lazy" decoding="asynchronous" />
        <span class="levelLabel supplyDepotLevelDisplay" *ngIf="nexusBase">
          {{nexusBase.supplyDepotLevel ? nexusBase.supplyDepotLevel : ''}}
          <span class="timerLabel">
            {{getBuildingTimerForBuilding("supply_depot") ? formatTimer(getBuildingTimerForBuilding("supply_depot").endTime) : ''}}
          </span>
        </span>
      </div>
    </div>



    <img [src]="nexusBase.commandCenterLevel < 3 ? cclvl1Src : nexusBase.commandCenterLevel < 4 ? cclvl2Src : cclvl3Src"
         class="commandCenterBackground"
         *ngIf="cclvl1Src && cclvl2Src && cclvl3Src && nexusBase"
         [style.display]="isCommandCenterOpen ? 'block' : 'none'"
         loading="lazy" decoding="asynchronous" />
    <div *ngIf="nexusBase" [style.display]="isCommandCenterOpen ? 'flex' : 'none'" class="commandCenterScreen">
      <div>
        Upgrade the Command Center to gain more worker slots.
        Worker slots allow you to upgrade more buildings simultaneously.
      </div>
      <div class="upgradeProgressDisplayP">
        Current upgrade limit : {{nexusBase.commandCenterLevel + 1}}
      </div>
      <div><button (click)="closeCommandCenter()">Back</button></div>
    </div>


    <img [src]="nexusBase.supplyDepotLevel < 3 ? sdlvl1Src : nexusBase.supplyDepotLevel < 4 ? sdlvl2Src : sdlvl3Src"
         class="supplyDepotBackground"
         *ngIf="sdlvl1Src && sdlvl2Src && sdlvl3Src && nexusBase"
         [style.display]="isSupplyDepotOpen ? 'block' : 'none'"
         loading="lazy" decoding="asynchronous" />
    <div [style.display]="isSupplyDepotOpen ? 'flex' : 'none'" class="supplyDepotScreen">
      <div class="supplyInfoDiv">
        <div class="supplyExplainDiv">
          For every supply depot level your supply capacity increases by 2500.
          <p class="gameNotification">ü•© Capacity: {{supplyCapacity}}</p>
          <p class="gameNotification" *ngIf="nexusBase">ü•© Used: <span [class]="supplyCapacity - nexusBase.supply <= 600 ? 'redText' : ''">{{nexusBase.supply}}</span></p>
        </div>
        <div class="supplyUsedDiv">
          <div *ngFor="let unit of units">
            {{unit.unitType}}: {{getSupplyUsedForUnit(unit.unitId)}}
          </div>
        </div>
      </div>
      <div><button (click)="closeSupplyDepot()">Back</button></div>
    </div>


    <img [src]="nexusBase.factoryLevel < 3 ? flvl1Src : nexusBase.factoryLevel < 4 ? flvl2Src : flvl3Src"
         class="factoryBackground"
         *ngIf="flvl1Src && flvl2Src && flvl3Src && nexusBase"
         [style.display]="isFactoryOpen ? 'block' : 'none'" loading="lazy" decoding="asynchronous" />
    <div [style.display]="isFactoryOpen ? 'flex' : 'none'" class="factoryScreen">

      <div *ngIf="calculateCurrentSupply() > 0">
        Upgrade the Factory to train more units simultaneously. Current training limit: <span class="redText">{{nexusBase?.factoryLevel ?? 0}}</span>
      </div>
      <div *ngIf="calculateCurrentSupply() == 0" class="redText">You require more supply.</div>
      <div *ngIf="calculateCurrentSupply() == 0">Upgrade the Supply Depot to train more units.</div>

      <div class="unitsTableDiv">
        <table class="upgradeDisplayTable">
          <tbody *ngFor="let unit of getFactoryUnits()">
            <tr>
              <td class="unitPictureTd" (click)="toggleUnitScreen(unit, true)">
                <img [src]="unit.pictureSrc" class="unitPicture" *ngIf="unit.pictureSrc" loading="lazy" decoding="asynchronous" />
              </td>
              <td class="unitPictureTd capitalize smallFont usernameProfileLink">
                {{ unit.unitType.replace('_', ' ') }}
              </td>
              <td class="unitSliderTd">
                <input type="range" class="unitSliderTd" [value]="unit.purchasedValue ?? 0" [min]="0" [max]="maxSliderValue(unit)" [step]="1" (input)="onSliderChange($event, unit)" />
              </td>
              <td>
                <input [value]="unit.purchasedValue ? unit.purchasedValue : '0'" (keyup)="onSliderChange($event, unit)" class="unitInput" />
              </td>
              <td class="unitPictureTd xxSmallFont invertedHighlights cursorPointer centeredText" (click)="unit.purchasedValue = maxSliderValue(unit)">
                {{maxSliderValue(unit)}}
              </td>
              <td class="unitPictureTd">
                <button [disabled]="!unit.purchasedValue || isLoading || (nexusBase && nexusBase.gold < unit.cost)" (click)="purchaseUnit(unit.unitId)">‚úîÔ∏è</button>
              </td>
            </tr>
            <tr>
              <td></td>
              <td class="smallFont" colspan="3">
                ü™ô{{ ((unit.purchasedValue ? unit.purchasedValue : 1) * unit.cost) }}
                ‚è±Ô∏è{{ formatTimer(unit.duration * (unit.purchasedValue ? unit.purchasedValue : 1))}}
                <span [class]="((unit.purchasedValue ? unit.purchasedValue : 1) * unit.supply) > supplyCapacity ? 'redText' : ''">ü•©{{ unit.supply ? (unit.purchasedValue ? unit.purchasedValue : 1) * unit.supply : ''}}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div><button (click)="closeFactory()">Back</button></div>
    </div>


    <img [src]="nexusBase.starportLevel < 3 ? splvl1Src : nexusBase.starportLevel < 4 ? splvl2Src : splvl3Src"
         class="starportBackground"
         *ngIf="splvl1Src && splvl2Src && splvl3Src && nexusBase"
         [style.display]="isStarportOpen ? 'block' : 'none'" loading="lazy" decoding="asynchronous" />
    <div [style.display]="isStarportOpen ? 'flex' : 'none'" class="starportScreen">

      <div *ngIf="calculateCurrentSupply() > 0">
        Upgrade the Starport to train more units simultaneously. Current training limit: <span class="redText">{{nexusBase?.starportLevel ?? 0}}</span>
      </div>
      <div *ngIf="calculateCurrentSupply() == 0" class="redText">You require more supply.</div>
      <div *ngIf="calculateCurrentSupply() == 0">Upgrade the Supply Depot to train more units.</div>

      <div class="unitsTableDiv">
        <table class="upgradeDisplayTable">
          <tbody *ngFor="let unit of getStarportUnits()">
            <tr>
              <td class="unitPictureTd" (click)="toggleUnitScreen(unit, true)">
                <img [src]="unit.pictureSrc" class="unitPicture" *ngIf="unit.pictureSrc" loading="lazy" decoding="asynchronous" />
              </td>
              <td class="unitPictureTd capitalize smallFont usernameProfileLink">
                {{ unit.unitType.replace('_', ' ') }}
              </td>
              <td class="unitSliderTd">
                <input type="range" class="unitSliderTd" [value]="unit.purchasedValue ?? 0" [min]="0" [max]="maxSliderValue(unit)" [step]="1" (input)="onSliderChange($event, unit)" />
              </td>
              <td>
                <input [value]="unit.purchasedValue ? unit.purchasedValue : '0'" (keyup)="onSliderChange($event, unit)" class="unitInput" />
              </td>
              <td class="unitPictureTd xxSmallFont invertedHighlights cursorPointer centeredText" (click)="unit.purchasedValue = maxSliderValue(unit)">
                {{maxSliderValue(unit)}}
              </td>
              <td class="unitPictureTd">
                <button [disabled]="!unit.purchasedValue || isLoading || (nexusBase && nexusBase.gold < unit.cost)" (click)="purchaseUnit(unit.unitId)">‚úîÔ∏è</button>
              </td>
            </tr>
            <tr>
              <td></td>
              <td class="smallFont" colspan="3">
                ü™ô{{ ((unit.purchasedValue ? unit.purchasedValue : 1) * unit.cost) }}
                ‚è±Ô∏è{{ formatTimer(unit.duration * (unit.purchasedValue ? unit.purchasedValue : 1))}}
                <span [class]="((unit.purchasedValue ? unit.purchasedValue : 1) * unit.supply) > supplyCapacity ? 'redText' : ''">ü•©{{ unit.supply ? (unit.purchasedValue ? unit.purchasedValue : 1) * unit.supply : ''}}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div><button (click)="closeStarport()">Back</button></div>
    </div>


    <img [src]="nexusBase.warehouseLevel < 3 ? whlvl1Src : nexusBase.warehouseLevel < 4 ? whlvl2Src : whlvl3Src"
         class="warehouseBackground"
         *ngIf="whlvl1Src && whlvl2Src && whlvl3Src && nexusBase"
         [style.display]="isWarehouseOpen ? 'block' : 'none'" loading="lazy" decoding="asynchronous" />
    <div [style.display]="isWarehouseOpen ? 'flex' : 'none'" class="warehouseScreen">
      ü™ô Current gold capacity : {{goldCapacity}}ü™ô
      <div class="warehouseLevelsDiv">
        <table class="mainTable">
          <thead>
            <tr>
              <th>Warehouse Level</th>
              <th>Capacity</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let i of warehouseUpgradeLevels" [class]="i == nexusBase?.warehouseLevel ? 'highlightBg' : ''">
              <td>{{i}}</td>
              <td>{{5000 * (i + 1)}}ü™ô</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div><button (click)="closeWarehouse()">Back</button></div>
    </div>


    <img [src]="nexusBase.engineeringBayLevel < 3 ? eblvl1Src : nexusBase.engineeringBayLevel < 4 ? eblvl2Src : eblvl3Src"
         class="engineeringBayBackground"
         *ngIf="eblvl1Src && eblvl2Src && eblvl3Src && nexusBase"
         [style.display]="isEngineeringBayOpen ? 'block' : 'none'" loading="lazy" decoding="asynchronous" />
    <div [style.display]="isEngineeringBayOpen ? 'flex' : 'none'" class="engineeringBayScreen">
      Upgrade units and create a drone that converts a Command Center to your ownership.
      <p class="researchDisplayP">Current upgrade limit: {{getEngineerBayUpgradeLimit()}}</p>
      <div class="unitsUpgradesDiv">
        <div class="unitsUpgradesDiv">
          <div class="unitResearches">
            <div *ngFor="let unit of unitsWithoutGlitcher ? unitsWithoutGlitcher : getUnitsWithoutGlitcher()" class="unitUpgradeDiv capitalize xxSmallFont gameNotification unitUpgradeDivContainer">
              <img [src]="unit.pictureSrc" loading="lazy" class="unitPicture" decoding="asynchronous" />
              <div class="unitUpgradeDiv">
                <p class="usernameProfileLink">Level: {{unit.unitLevel}}</p>
                <p class="usernameProfileLink">ü™ô: {{unit.cost * 10 * ((unit.unitLevel ? unit.unitLevel : 0) + 1)}}</p>
              </div>
              <button [disabled]="isLoading" (click)="research(unit)" *ngIf="unit.unitLevel < 3">{{researchTimers[unit.unitType] ? formatTimer(researchTimers[unit.unitType].endTime) : 'üîß'}}</button>
            </div>
          </div>

          <div class=""
               *ngIf="glitcherStats && nexusBase && (nexusBase.factoryLevel >= glitcherStats.factoryLevel) && (nexusBase.starportLevel >= glitcherStats.starportLevel) && (nexusBase.engineeringBayLevel >= glitcherStats.engineeringBayLevel)">
            <table class="upgradeDisplayTable">
              <tbody>
                <tr>
                  <td class="unitPictureTd" (click)="toggleUnitScreen(glitcherStats, true)">
                    <img [src]="glitcherStats.pictureSrc" class="unitPicture" *ngIf="glitcherStats.pictureSrc" loading="lazy" decoding="asynchronous" />
                  </td>
                  <td class="unitPictureTd capitalize smallFont usernameProfileLink">
                    {{ glitcherStats.unitType }}
                  </td>
                  <td class="unitSliderTd">
                    <input type="range" class="unitSliderTd" [value]="glitcherStats.purchasedValue ?? 0" [min]="0" [max]="maxSliderValue(glitcherStats)" [step]="1" (input)="onSliderChange($event, glitcherStats)" />
                  </td>
                  <td>
                    <input [value]="glitcherStats.purchasedValue ? glitcherStats.purchasedValue : '0'" (keyup)="onSliderChange($event, glitcherStats)" class="unitInput" />
                  </td>
                  <td class="unitPictureTd xxSmallFont invertedHighlights cursorPointer centeredText" (click)="glitcherStats.purchasedValue = maxSliderValue(glitcherStats)">
                    {{maxSliderValue(glitcherStats)}}
                  </td>
                  <td class="unitPictureTd">
                    <button [disabled]="!glitcherStats.purchasedValue || isLoading || (nexusBase && nexusBase.gold < glitcherStats.cost)" (click)="purchaseUnit(glitcherStats.unitId)">‚úîÔ∏è</button>
                  </td>
                </tr>
                <tr>
                  <td></td>
                  <td class="smallFont" colspan="3">
                    ü™ô{{ ((glitcherStats.purchasedValue ? glitcherStats.purchasedValue : 1) * glitcherStats.cost) }}
                    ‚è±Ô∏è{{ formatTimer(glitcherStats.duration * (glitcherStats.purchasedValue ? glitcherStats.purchasedValue : 1))}}
                    <span [class]="((glitcherStats.purchasedValue ? glitcherStats.purchasedValue : 1) * glitcherStats.supply) > supplyCapacity ? 'redText' : ''">ü•©{{ glitcherStats.supply ? (glitcherStats.purchasedValue ? glitcherStats.purchasedValue : 1) * glitcherStats.supply : ''}}</span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div><button (click)="closeEngineeringBay()">Back</button></div>
    </div>


    <img [src]="nexusBase.minesLevel < 3 ? mineslvl1Src : nexusBase.minesLevel < 4 ? mineslvl2Src : mineslvl3Src"
         class="minesBackground"
         *ngIf="mineslvl1Src && mineslvl2Src && mineslvl3Src && nexusBase"
         [style.display]="isMinesOpen ? 'block' : 'none'" loading="lazy" decoding="asynchronous" />
    <div [style.display]="isMinesOpen ? 'flex' : 'none'" class="minesScreen">
      <div>
        <div>Upgrade the mines to increase mining efficiency.</div> 
        <div>ü™ô Current mining speed: <span class="gameNotification">1 Gold per {{miningSpeed}} second(s)</span>.</div>
      </div>
      <div><button (click)="closeMines()">Back</button></div>
    </div>
  </div>


  <div class="upgradesTableDiv" [style.display]="isCommandCenterOpen ? 'block' : 'none'">
    Upgrades Available:
    <table class="mainTable">
      <thead>
        <tr>
          <th>Building</th>
          <th>Level</th>
          <th>ü™ô</th>
          <th>Duration</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let upgrade of (currentValidAvailableUpgrades ? currentValidAvailableUpgrades : getValidBuildingUpgrades())">
          <td>{{upgrade.building}}</td>
          <td>{{upgrade.nextLevel + 1}}</td>
          <td>{{upgrade.cost}}</td>
          <td>{{formatTimer(upgrade.duration)}}</td>
          <td>
            <button [disabled]="isLoading" (click)="upgradeBuilding(upgrade, upgrade.duration)" #upgradeButton>
              {{ getBuildingTimerForBuilding(upgrade.building) ? formatTimer(getBuildingTimerForBuilding(upgrade.building).endTime) : (nexusBase && nexusBase.gold < upgrade.cost) ? '‚õî' :  'üîß' }}
            </button>
          </td>
        </tr>
      </tbody>
      <tbody *ngIf="!currentValidAvailableUpgrades || currentValidAvailableUpgrades.length == 0">
        <tr>
          <td colspan="5">All buildings are maxed out on upgrades.</td>
        </tr>
      </tbody>
    </table>
  </div>


  <div [style.display]="toggledUnitStat ? 'block' : 'none'">
    <div class="toggledUnitStatScreen" *ngIf="toggledUnitStat">
      <div class="toggledUnitStatInfoDiv smallFont">
        <div class="usernameProfileLink capitalize">{{toggledUnitStat.unitType.replace('_', ' ')}}</div>
        <div class="gameNotification">Unit level: {{toggledUnitStat.unitLevel}}</div>
        <div class="gameNotification">Ground damage : {{toggledUnitStat.groundDamage}}</div>
        <div class="gameNotification">Air damage : {{toggledUnitStat.airDamage}}</div>
        <div class="gameNotification">Training duration time: {{formatTimer(toggledUnitStat.duration)}}</div>
        <div class="gameNotification">ü™ô per unit: {{toggledUnitStat.cost}}</div>
        <div class="gameNotification">Travel speed: {{toggledUnitStat.speed}}</div>
        <div class="gameNotification">Supply cost: {{toggledUnitStat.supply}}</div>
        <div class="gameNotification">ü™ô carrying capacity: {{toggledUnitStat.goldCarryingCapacity}}</div>
        <div class="gameNotification">Required Factory level: {{toggledUnitStat.factoryLevel}}</div>
        <div class="gameNotification">Required Starport level: {{toggledUnitStat.starportLevel}}</div>
        <div class="gameNotification">Required Engineering Bay level: {{toggledUnitStat.engineeringBayLevel}}</div>
      </div>
      <div class="toggledUnitStatInfoPic">
        <img class="toggledUnitStatInfoPicImg"
             [src]="toggledUnitStat.pictureSrc"
             *ngIf="toggledUnitStat.pictureSrc"
             [style.display]="toggledUnitStat ? 'block' : 'none'" loading="lazy" decoding="asynchronous" />
        <button (click)="toggleUnitScreen(toggledUnitStat, false)">Close</button>
      </div>
    </div>
  </div>

  <div [style.display]="!isCommandCenterOpen && !toggledUnitStat && !isMapOpen && !isReportsOpen && !isBasesOpen && !isSupportOpen && !isUserNew && !isUserComponentOpen ? 'block' : 'none'">
    <span *ngIf="activeAttackTimers().length > 0 || activeDefenceTimers().length > 0" class="mainInfoSection">Movement:</span>
    <div *ngIf="activeAttackTimers().length > 0 || activeDefenceTimers().length > 0">
      <div class="upgradeTimersTableDiv">
        <div *ngFor="let timer of activeAttackTimers()" [class]="(timer.unit.includes('Support') ? 'defenceProgressDisplayP' : 'unitProgressDisplayP') + ' capitalize'" (click)="openMapAndScrollTo(timer.unit)">
          {{ formatBuildingTimer(timer.unit)   }} {{ formatTimer(timer.endTime) }}
        </div>
        <div *ngFor="let timer of activeDefenceTimers()" [class]="(timer.unit.includes('Support') ? 'defenceProgressDisplayP' : 'unitProgressDisplayP') + ' capitalize'" (click)="openMapAndScrollTo(timer.unit)">
          {{ formatBuildingTimer(timer.unit)   }} {{ formatTimer(timer.endTime) }}
        </div>
      </div>
    </div>
    <div *ngIf="activeUnitTimers().length > 0">
      <span class="mainInfoSection">Training:</span>
      <div class="upgradeTimersTableDiv">
        <div *ngIf="activeUnitTimers().length > 0">
          <div *ngFor="let timer of activeUnitTimers()" class="unitProgressDisplayP capitalize">
            {{formatBuildingTimer(timer.unit) }} {{ formatTimer(timer.endTime) }}
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="activeResearchTimers().length > 0">
      <span class="mainInfoSection">Research:</span>
      <div class="upgradeTimersTableDiv">
        <div *ngIf="activeResearchTimers().length > 0">
          <div *ngFor="let timer of activeResearchTimers()" class="researchDisplayP capitalize">
            {{formatBuildingTimer(timer.unit) }} {{ formatTimer(timer.endTime) }}
          </div>
        </div>
      </div>
    </div>
    <!--Building: <span class="xxSmallFont redText" *ngIf="!activeBuildingTimers() || activeBuildingTimers().length == 0">[No building.]</span>
    <div class="upgradeTimersTableDiv">
      <ng-container *ngIf="activeBuildingTimers().length > 0">
        <div *ngFor="let timer of activeBuildingTimers()">
          <p class="upgradeProgressDisplayP capitalize">
            {{ formatBuildingTimer(timer.building) }} {{ formatTimer(timer.endTime) }}
          </p>
        </div>
      </ng-container>
    </div>-->
  </div>
  <div class="unitslist" [style.display]="!isCommandCenterOpen && !isMapOpen && !isReportsOpen && !isBasesOpen && !isSupportOpen && !isUserNew && !isUserComponentOpen && !toggledUnitStat ? 'block' : 'none'">
    <div *ngIf="nexusAvailableUnits">
      <span class="mainInfoSection">Available:</span>
      <app-nexus-base-units [parentRef]="parentRef"
                            [nexusAvailableUnits]="nexusAvailableUnits"
                            [marinePictureSrc]="marinePictureSrc"
                            [goliathPictureSrc]="goliathPictureSrc"
                            [siegeTankPictureSrc]="siegeTankPictureSrc"
                            [scoutPictureSrc]="scoutPictureSrc"
                            [wraithPictureSrc]="wraithPictureSrc"
                            [battlecruiserPictureSrc]="battlecruiserPictureSrc"
                            [glitcherPictureSrc]="glitcherPictureSrc"
                            (toggleUnitScreen)="toggleUnitScreenFromBaseUnits($event)">
      </app-nexus-base-units>
    </div>
    <div *ngIf="nexusExternalSupportUnits">
      <span class="mainInfoSection">Support:</span>
      <app-nexus-base-units [parentRef]="parentRef"
                            [nexusAvailableUnits]="nexusExternalSupportUnits"
                            [marinePictureSrc]="marinePictureSrc"
                            [goliathPictureSrc]="goliathPictureSrc"
                            [siegeTankPictureSrc]="siegeTankPictureSrc"
                            [scoutPictureSrc]="scoutPictureSrc"
                            [wraithPictureSrc]="wraithPictureSrc"
                            [battlecruiserPictureSrc]="battlecruiserPictureSrc"
                            [glitcherPictureSrc]="glitcherPictureSrc"
                            (toggleUnitScreen)="toggleUnitScreenFromBaseUnits($event)">
      </app-nexus-base-units>
    </div>
    <div *ngIf="nexusUnitsOutsideOfBase">
      <span class="mainInfoSection">Outside:</span>
      <app-nexus-base-units [parentRef]="parentRef"
                            [nexusAvailableUnits]="nexusUnitsOutsideOfBase"
                            [marinePictureSrc]="marinePictureSrc"
                            [goliathPictureSrc]="goliathPictureSrc"
                            [siegeTankPictureSrc]="siegeTankPictureSrc"
                            [scoutPictureSrc]="scoutPictureSrc"
                            [wraithPictureSrc]="wraithPictureSrc"
                            [battlecruiserPictureSrc]="battlecruiserPictureSrc"
                            [glitcherPictureSrc]="glitcherPictureSrc"
                            (toggleUnitScreen)="toggleUnitScreenFromBaseUnits($event)">
      </app-nexus-base-units>
    </div>
  </div>
  <div class="gameNotificationDiv">
    <div *ngFor="let notif of notifications" class="gameNotification" (click)="notifications = []">>{{notif}}</div>
  </div>
  <div *ngIf="isUserComponentOpen">
    <app-user [loginOnly]="true"
              [inputtedParentRef]="parentRef"
              [canClose]="false"
              (closeUserComponentEvent)="closeUserComponent($event)"
              [loginReasonMessage]="'You must log in to volunteer in the Bug Wars.'"></app-user>
  </div>

  <div class="shareMapButtonDiv">
    <button (click)="copyLink()" title="Share Link">Share üìã</button>
    <span *ngIf="!isUserNew && parentRef && parentRef.user">
      <button (click)="toggleScreen('map', !isMapOpen)" title="View Map">{{isMapOpen ? 'Close ' : ''}}Map üó∫Ô∏è</button>
      <button (click)="toggleScreen('reports', !isReportsOpen)" title="View Reports">{{isReportsOpen ? 'Close ' : ''}}Data üìÉ</button>
      <button (click)="toggleScreen('bases', !isBasesOpen)" title="View Bases">{{isBasesOpen ? 'Close ' : ''}}Bases üè∞</button>
      <button (click)="toggleScreen('support', !isSupportOpen)" title="View Support">{{isSupportOpen ? 'Close ' : ''}}Support üõ°Ô∏è</button>
    </span>
  </div>
</div>
