<div class="componentMain">
  <div class="closeButton" (click)="remove_me('FileComponent');" *ngIf="!user"></div>
  <div class="menuButton" (click)="showMenuPanel();"></div>
  <div class="componentTitle" *ngIf="!user">Files</div>

  <div class="massDeleteControls" *ngIf="massDeleteMode" style="margin:8px 0; text-align: center;">
    <button (click)="confirmMassDelete()" class="dangerButton">❌Delete Selected ({{ fileSearchComponent.selectedCount() || 0 }})</button>
    <button (click)="cancelMassDelete()">Cancel Mass Delete</button>
  </div>

  <app-user-list (userClickEvent)="shareFile($event);" [user]="parentRef?.user!" *ngIf="isSharePanelExpanded && !user"></app-user-list>

 
  <app-file-search [user]="parentRef?.user"
                   [inputtedParentRef]="parentRef"
                   [maxResults]="100"
                   [fileId]="fileId"
                   [commentId]="commentId"
                   [displayComments]="true"
                   [captureNotifications]="true"
                   [massDeleteMode]="massDeleteMode"
                   (currentDirectoryChangeEvent)="changeDirectoryEvent($event)"
                   (userNotificationEvent)="uploadNotification($event);">
  </app-file-search>
</div>

<!-- Menu Popup -->
<div class="popupPanel" *ngIf="isMenuPanelOpen">
  <div class="popupPanelTitle" style="margin-bottom:15px;">
    File Menu
  </div> 
  <div *ngIf="!user && canUploadToFolder()" class="uploadAndNewFolderButtonDiv"> 
    <button (click)="showMakeDirectoryPrompt=true;" title="Make a New Folder" *ngIf="!showMakeDirectoryPrompt">📂New Folder</button>
    <button (click)="enableMassDeleteMode()" title="Enable Mass Delete" *ngIf="!massDeleteMode">❌Mass Delete</button>

    <app-file-upload (userUploadEvent)="uploadInitiate();"
                      (userUploadFinishedEvent)="uploadFinished($event)"
                      (userNotificationEvent)="uploadNotification($event);"
                      (userCancelEvent)="cancelMakeDirectoryOrFile();"
                      [currentDirectory]="currentDirectory"
                      [user]="parentRef?.user!"
                      [inputtedParentRef]="parentRef"
                      [uploadButtonText]="'Upload File(s)'"
                      [showPrivatePublicOption]="isUploadInitiate ? true : false"
                      *ngIf="canUploadToFolder() && !showMakeDirectoryPrompt">
    </app-file-upload>

    <div *ngIf="showMakeDirectoryPrompt">
      <input placeholder="Folder Name" #makeFolderName />
      <label>
        <select #folderVisibility [value]="createVisibility" (change)="createVisibilityOnChange()">
          <option value="public">Public</option>
          <option value="private">Private</option>
        </select>
      </label>
      <button (click)="makeDirectory()">Create Folder</button>
      <button (click)="cancelMakeDirectoryOrFile()">Cancel</button>
    </div>
  </div>  

  <div style="margin-top: 15px;">
    <div class="popupPanelTitle">
      Search Popular Topics:
    </div>
    <div *ngIf="topTopics">
      <span *ngFor="let topic of topTopics | slice:0:15" (click)="topTopicClicked(topic)" class="topTopicsDiv">
        <span class="matchingTopic">{{topic.topicName}}</span>
        <span class="topicFileCount">({{topic.fileCount}})</span>
      </span>
    </div>
  </div>
  <div class="browserInstructions">
    For your browsing convenience on Desktop, you may use the J and K buttons on your keyboard to scroll through files.
  </div>
  <button id="closeOverlay" class="closeButton" (click)="closeMenuPanel()">Close</button>
</div>