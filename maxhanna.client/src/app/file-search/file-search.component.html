<div *ngFor="let notif of notifications" [innerHTML]="notif" class="notification" (click)="notifications = []"></div>
<div class="filters" *ngIf="showPrivatePublicOption && showData">
  <div>
    <label>
      Visibility:
      <select (change)="setFilterVisibility($event)">
        <option value="all" [selected]="filter.visibility === 'all'">All</option>
        <option value="public" [selected]="filter.visibility === 'public'">Public</option>
        <option value="private" [selected]="filter.visibility === 'private'">Private</option>
      </select>
    </label>
  </div>
  <div>
    <label>
      Ownership:
      <select (change)="setFilterOwnership($event)">
        <option value="own" [selected]="filter.ownership === 'own'">Own</option>
        <option value="others" [selected]="filter.ownership === 'others'">Others</option>
      </select>
    </label>
  </div>
</div>
<div class="searchInput">
  <input #search (keyup)="searchDirectory()" placeholder="üîçSearch {{currentDirectory}}" />
</div>

<div *ngIf="showData">
  <!-- Pagination Controls -->
  <div *ngIf="directory" class="pageContainerDiv">
    <button (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
    <span>Page {{currentPage}} of {{totalPages}}</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
  </div>
  <div>Total: {{directory?.totalCount}}</div>

  <!-- Main Data -->
  <div class="">
    <table class="mainTable" id="fileTable" *ngIf="!isLoading">
      <thead>
        <tr *ngIf="showUpFolderRow && canChangeDirectory">
          <th (click)="previousDirectory()"
              class="upOneFolder"
              title="Up one folder"
              (drop)="onDrop('...')"
              (dragover)="onDragOver($event)"
              colspan="4">
            ‚¨ÜÔ∏èüìÅ...
          </th>
        </tr>
        <tr>
          <th>File</th>
          <th *ngIf="displayFileActions" class="actionTd"></th>
          <th *ngIf="displayFileType" class="typeTd">
            Type
          </th>
          <th *ngIf="displayFileSize" class="fileSizeTd">
            Size
          </th>
          <th *ngIf="displayComments" class="commentCountTd" title="Number of comments">
            üó®Ô∏è
          </th>
        </tr>
      </thead>
      <tbody *ngIf="directory && directory.totalCount! > 0">
        <ng-container *ngFor="let file of directory.data; let i = index">
          <tr draggable="true"
              (dragstart)="onDragStart($event, file.fileName)">
            <td class="{{ file.isFolder ? 'folder' : '' }}"
                (click)="selectFile(file);"
                (dragover)="onDragOver($event)"
                (drop)="onDrop(file.fileName)"
                [id]="'fileIdTd'+file.id"
                [attr.data-content]="file?.fileData?.givenFileName ?? file.fileName.split('.')[0]!">
              <input type="text"
                     placeholder="New file name"
                     [value]="file?.fileData?.givenFileName ?? file.fileName.split('.')[0]!"
                     [style.display]="isEditing.includes(file.id) ? 'inline-block':'none' "
                     (keyup)="editFileKeyUp($event, file.id)"
                     (click)="$event.stopPropagation()"
                     [id]="'editFileNameInput'+file.id" />
              {{isEditing.includes(file.id) ? '' : file?.fileData?.givenFileName ?? getFileWithoutExtension(file.fileName)!}}
            </td>
            <td class="actionTd" *ngIf="displayFileActions">
              <button [style.display]="file?.user?.id == user?.id ? 'inline-block':'none' " (click)="startEditing(file.id, $event)">‚úèÔ∏è</button>
              <input value="‚ÜóÔ∏è"
                     type="submit"
                     title="Share File"
                     *ngIf="file?.visibility?.toLowerCase() == 'private'" />
              <input value="‚ùå"
                     type="submit"
                     (click)="this.delete(file);"
                     *ngIf="file?.sharedWith?.includes(user?.id!+'') || file?.user?.id == user?.id!" />
              <button (click)="upvoteFile(file)">
                üëç{{file.upvotes}}
              </button>
              <button (click)="downvoteFile(file)">
                üëé{{file.downvotes}}
              </button>
            </td>
            <td class="typeTd" (click)="selectFile(file);" *ngIf="displayFileType">
              <span *ngIf="file && file.fileType"
                    [class]="file.visibility == 'Private' ? 'fileTypeSpan' : ''">
                {{file.fileType.toUpperCase()}}
              </span>
              <span [class]="file.visibility == 'Private' ? 'private':''"
                    title="This is a private file.">
                {{file.visibility == 'Private' ? 'üîí' : ''}}
              </span>
            </td>
            <td class="fileSizeTd" (click)="selectFile(file);" *ngIf="displayFileSize">
              <span *ngIf="file && file.fileSize">
                {{formatFileSize(file.fileSize)}}
              </span> 
            </td>
            <td *ngIf="displayComments" class="commentCountTd">
              {{file?.fileComments?.length ?? 0}}
            </td>
          </tr>
          <tr *ngIf="openedFiles.includes(file.id)">
            <td colspan="4">
              <app-media-viewer #mediaViewerComponent [user]="user" [inputtedParentRef]="inputtedParentRef" *ngIf="viewMediaFile && openedFiles.includes(file.id)"></app-media-viewer>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
    <div *ngIf="isLoading">
      Loading Data...
    </div>
    <div *ngIf="!isLoading && directory && directory.totalCount == 0">
      Empty.
    </div>
  </div>
</div>
