<div *ngFor="let notif of notifications" [innerHTML]="notif" class="notification" (click)="notifications = []"></div>
<div class="filters" *ngIf="showPrivatePublicOption && showData">
  <div>
    <label>
      Visibility:
      <select (change)="setFilterVisibility($event)">
        <option value="all" [selected]="filter.visibility === 'all'">All</option>
        <option value="public" [selected]="filter.visibility === 'public'">Public</option>
        <option value="private" [selected]="filter.visibility === 'private'">Private</option>
      </select>
    </label>
  </div>
  <div>
    <label>
      Ownership:
      <select (change)="setFilterOwnership($event)">
        <option value="own" [selected]="filter.ownership === 'own'">Own</option>
        <option value="others" [selected]="filter.ownership === 'others'">Others</option>
      </select>
    </label>
  </div>
</div>
<div class="searchInput">
  <input #search (keyup)="searchDirectory()" placeholder="üîçSearch {{currentDirectory}}" />
</div>

<div *ngIf="showData">
  <!-- Pagination Controls -->
  <div *ngIf="directory" class="pageContainerDiv">
    <button (click)="previousPage()" [disabled]="currentPage === 1">Previous</button>
    <span>Page {{currentPage}} of {{totalPages}}</span>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
  </div>
  <div>Total: {{directory?.totalCount}}</div>

  <!-- Main Data -->
  <div class="">
    <div id="fileTable" *ngIf="!isLoading">
      <div *ngIf="showUpFolderRow && canChangeDirectory">
        <div (click)="previousDirectory()"
             class="upOneFolder"
             title="Up one folder"
             (drop)="onDrop('...')"
             (dragover)="onDragOver($event)"
             colspan="4">
          ‚¨ÜÔ∏èüìÅ...
        </div>
      </div>

      <div *ngIf="directory && directory.totalCount! > 0" class="directoryDisplayDiv">
        <ng-container *ngFor="let file of directory.data; let i = index">
          <div class="draggableDiv"
               draggable="true"
               (dragstart)="onDragStart($event, file.fileName)">
            <div class="fileNameDiv {{ file.isFolder ? 'folder' : '' }}"
                 (dragover)="onDragOver($event)"
                 (drop)="onDrop(file.fileName)"
                 [id]="'fileIdDiv'+file.id"
                 [attr.data-content]="file?.fileData?.givenFileName ?? file.fileName.split('.')[0]!">
              <input type="text"
                     placeholder="New file name"
                     [value]="file?.fileData?.givenFileName ?? file.fileName.split('.')[0]!"
                     [style.display]="isEditing.includes(file.id) ? 'inline-block':'none' "
                     (keyup)="editFileKeyUp($event, file.id)"
                     (click)="$event.stopPropagation()"
                     [id]="'editFileNameInput'+file.id" />

              <span class="fileFolderNameSpan {{file.isFolder ? 'folder' : ''}}" (click)="selectFile(file);" [id]="'fileIdName'+file.id">
                {{file.isFolder ? 'üìÅ' : ''}}{{isEditing.includes(file.id) ? '' : file?.fileData?.givenFileName ?? getFileWithoutExtension(file.fileName)!}}
              </span>

              <div class="fileExtras">
                <app-reaction *ngIf="displayReactions && !file.isFolder"
                              [user]="user"
                              [currentReactions]="file.reactions"
                              [fileId]="file.id">
                </app-reaction>
                <div *ngIf="displayComments" class="commentCountTd">
                  {{file && file.fileComments ? 'üó®Ô∏è' + file.fileComments.length : ''}}
                </div>
                <div class="typeTd" (click)="selectFile(file);" *ngIf="displayFileType">
                  <span *ngIf="file && file.fileType">
                    {{file.fileType.toUpperCase()}}
                  </span>
                  <span [class]="file.visibility == 'Private' ? 'private':''"
                        title="This is a private file.">
                    {{file.visibility == 'Private' ? 'üîí' : ''}}
                  </span>
                </div>
                <div class="fileSizeTd" (click)="selectFile(file);" *ngIf="displayFileSize">
                  <span *ngIf="file && file.fileSize">
                    {{formatFileSize(file.fileSize)}}
                  </span>
                </div>
                <div class="actionTd" *ngIf="displayFileActions">
                  <button [style.display]="file?.user?.id == user?.id && !file?.isFolder ? 'inline-block':'none' " (click)="startEditing(file.id, $event)">
                    ‚úèÔ∏èEdit
                  </button>
                  <!--<button title="Share File"
                *ngIf="file?.visibility?.toLowerCase() == 'private'">
          ‚ÜóÔ∏èShare
        </button>-->
                  <button (click)="this.delete(file);"
                          *ngIf="
                            file?.sharedWith?.includes(user?.id!+'')
                            || file?.user?.id == user?.id!
                            && !(this.currentDirectory == '' && (file.fileName == 'Users' || file.fileName == 'Meme' || file.fileName == 'Roms'
                                                                || file.fileName == 'Max'  || file.fileName == 'Pictures'  || file.fileName == 'Videos'))">
                    ‚ùåDelete
                  </button>
                </div>
              </div>
            </div>
            <div *ngIf="openedFiles.includes(file.id)" class="mediaViewDiv">
              <app-media-viewer #mediaViewerComponent
                                [user]="user"
                                [file]="file"
                                [inputtedParentRef]="inputtedParentRef"
                                *ngIf="viewMediaFile && openedFiles.includes(file.id)">
              </app-media-viewer>
            </div>
          </div> 
        </ng-container>
      </div>
    </div>
    <div *ngIf="isLoading || !directory">
      Loading Data...
    </div>
    <div *ngIf="!isLoading && directory && directory.totalCount == 0">
      Empty.
    </div>
  </div>
</div>
