<div class="metaHighscoresSection">
    <div *ngIf="modesSelected.length">
        <div *ngFor="let m of modesSelected" class="mode-section">
            <div *ngIf="showHeader"
                (click)="showUserHeader ? (parentRef?.createComponent(headerClickTarget ?? 'Ender')) : toggleMode(m)"
                [class]="(showUserHeader ? 'popupPanelTitle userPopupPanelTitle clickable' : (showHeaderTitles ? 'popupPanelTitle clickable' : 'regularTitle clickable'))"
                [style.marginTop]="'0px'">
                {{ m === 'today' ? "Today's Ender Scores:" : (m === 'user' ? "Your Ender Scores:" : (m === 'best' ? 'Best Ender Scores (All Time):' : "All-time Ender Scores:")) }}
                <span *ngIf="!showUserHeader" style="float:right; font-size:0.9em">{{ isModeCollapsed(m) ? '+' : '−' }}</span>
            </div>

            <ng-container *ngIf="!isModeCollapsed(m)">
                <ng-container *ngIf="groupedByMode[m] && hasGroups(m); else emptyMode">
                    <div *ngFor="let group of (groupedByMode[m] | keyvalue)" class="difficulty-group"> 
                        <ng-container *ngIf="group.value && group.value.length > 0; else emptyGroup">
                            <div *ngFor="let s of group.value">
                                <div style="padding:6px; border-bottom:1px solid #333; display:flex; align-items:center; gap:8px;">
                                    <div style="flex:0 0 auto;">
                                        <app-user-tag [user]="s.user" [inputtedParentRef]="inputtedParentRef ?? parentRef" [displayMiniTag]="true" [previousComponent]="'Ender'"></app-user-tag>
                                    </div>
                                    <div style="flex:1 1 auto;">
                                        <div><strong>Score:</strong> {{s.score}}</div>
                                        <div><small>Time on map: {{s.time_on_level_seconds}}s • Kills: {{s.kills ?? 0}} • Walls placed: {{s.walls_placed}} • Level: {{s.level ?? 1}}</small></div>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                        <ng-template #emptyGroup>
                            <div class="no-scores">
                                No{{" "}}
                                <app-menu-item 
                                    style="display: inline-block;"
                                    [type]="'Ender'" 
                                    [parentRef]="inputtedParentRef ?? parentRef"></app-menu-item>
                                {{" "}}scores to show for {{ m }}.
                            </div>
                        </ng-template>
                    </div>
                </ng-container>
            </ng-container>

            <ng-template #emptyMode>
                <div class="no-scores">No scores to show for {{ m }}.</div>
            </ng-template>
        </div>
    </div>
</div>