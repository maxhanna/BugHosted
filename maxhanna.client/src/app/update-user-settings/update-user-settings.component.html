<div class="componentMain">
  <div class="closeButton" (click)="remove_me('UpdateUserProfile')"></div>
  <div class="refreshButton" (click)="ngOnInit()"></div>
  <div class="componentTitle">Settings</div>
  <div *ngFor="let notif of notifications" [innerHTML]="notif" (click)="notifications = [];" title="Click to clear notifications" class="notificationArea notification"></div>


  <input type="submit" value="Delete Account üóëÔ∏è" (click)="deleteUser()" title="Delete Account" />

  <div *ngIf="parentRef!.user" style="margin-top:15px">
    <fieldset>
      <legend>Update:</legend>
      <table class="updateTable">

        <!--USERNAME / PASSWORD-->
        <thead (click)="isGeneralToggled = !isGeneralToggled">
          <tr>
            <th>
              <span class="helperSpanTitle" title="Change your username or password."></span>
            </th>
            <th>General</th>
            <th style="text-align:right;">
              <button (click)="updateUser()" title="Update settings" [disabled]="!isGeneralToggled" *ngIf="isGeneralToggled">üîÑ</button>
            </th>
          </tr>
        </thead>
        <tbody *ngIf="isGeneralToggled">
          <tr>
            <td>Name:</td>
            <td><input type="text" placeholder="New Username" #updatedUsername [value]="parentRef!.user!.username" /></td>
          </tr>
          <tr>
            <td>Password:</td>
            <td><input type="password" placeholder="New Password" #updatedPassword [value]="parentRef!.user!.pass" /></td>
          </tr>
        </tbody>


        <!--Display Picture-->
        <thead (click)="isDisplayPictureToggled = !isDisplayPictureToggled">
          <tr>
            <th>
              <span class="helperSpanTitle" title="Change your display picture"></span>
            </th>
            <th>Display Picture</th>
            <th></th>
          </tr>
        </thead>
        <tbody *ngIf="isDisplayPictureToggled">
          <tr>
            <td></td>
            <td>
              Upload or Select a profile picture here:
              <div class="avatar" *ngIf="!this.parentRef?.user!.displayPictureFile">
                <span class="avatarBug">ü™≤</span>
                <span class="avatarBust">üë§</span>
              </div>
              <div *ngIf="this.parentRef?.user?.displayPictureFile">
                Current display picture:
                <div class="avatar">
                  <app-media-viewer #displayPictureViewer
                                    [displayExpander]="false"
                                    [displayExtraInfo]="false"
                                    [showCommentSection]="false"
                                    [file]="this.parentRef?.user!.displayPictureFile"
                                    [currentDirectory]="this.parentRef?.user!.displayPictureFile!.directory"
                                    [user]="parentRef!.user"
                                    [inputtedParentRef]="parentRef!">
                  </app-media-viewer>
                </div>
              </div>
            </td>
            <td>
              <app-media-selector #displayPictureSelector
                                  [maxSelectedFiles]="1"
                                  [inputtedParentRef]="parentRef"
                                  [user]="parentRef?.user"
                                  [currentDirectory]="'Users/'+parentRef?.user?.username"
                                  (selectFileEvent)="avatarSelected($event)">
              </app-media-selector>
            </td>
          </tr>
        </tbody>


        <!--ABOUT-->
        <thead (click)="isAboutToggled = !isAboutToggled">
          <tr>
            <th>
              <span class="helperSpanTitle" title="Your contact information."></span>
            </th>
            <th>About You</th>
            <th style="text-align:right;">
              <button (click)="updateUserAbout()" title="Update information" [disabled]="!isAboutToggled" *ngIf="isAboutToggled">üîÑ</button>
            </th>
          </tr>
        </thead>
        <tbody *ngIf="isAboutToggled">
          <tr>
            <td colspan="3">
              <table class="mainTable">
                <tbody>
                  <tr>
                    <td>Description:</td>
                    <td><input type="text" placeholder="Profile description" #updatedDescription [value]="parentRef?.user?.about?.description" /></td>
                  </tr>
                  <tr>
                    <td>Birthday:</td>
                    <td><input type="date" #updatedBirthday [value]="formatDate(parentRef?.user?.about?.birthday!)" /></td>
                  </tr>
                  <tr>
                    <td>Email:</td>
                    <td><input type="text" #updatedEmail [value]="parentRef?.user?.about?.email" /></td>
                  </tr>
                  <tr>
                    <td>Phone:</td>
                    <td><input type="tel" #updatedPhone [value]="parentRef?.user?.about?.phone" /></td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </tbody>


        <!-- Menu Icons -->
        <thead (click)="isMenuIconsToggled = !isMenuIconsToggled; getMenuIcons()">
          <tr>
            <th>
              <span class="helperSpanTitle" title="Add / Remove icons from your menu."></span>
            </th>
            <th colspan="2">Selectable Menu Items</th>
          </tr>
        </thead>
        <tbody *ngIf="isMenuIconsToggled">
          <tr>
            <td class="" colspan=3>
              <table class="mainTable">
                <thead>
                  <tr>
                    <th colspan="3">Menu Item</th>
                  </tr>
                </thead>
                <tbody *ngIf="selectableIcons">
                  <tr *ngFor="let icon of selectableIcons" (click)="selectMenuIcon(icon.title)">
                    <td>
                      <input type="checkbox" [checked]="menuIconsIncludes(icon.title)" />
                    </td>
                    <td>{{ icon.title == 'Weather' ? '‚òÄÔ∏è' : icon.icon }}</td>
                    <td>{{ icon.title }}</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </tbody>

        <!--Weather-->
        <thead (click)="isWeatherLocationToggled = !isWeatherLocationToggled; getWeatherLocation()">
          <tr>
            <th>
              <span class="helperSpanTitle" title="Default is to automatically update your weather based on your IP address,
but you can also set your own City for a more precise location."></span>
            </th>
            <th>Weather Location</th>
            <th style="text-align:right;">
              <button (click)="updateWeatherLocation()" title="Update settings" [disabled]="!isWeatherLocationToggled" *ngIf="isWeatherLocationToggled">üîÑ</button>
            </th>
          </tr>
        </thead>
        <tbody *ngIf="isWeatherLocationToggled">
          <tr>
            <td>Location:</td>
            <td><input type="text" placeholder="IP Address/City (ex: 'Montreal')" #weatherLocationInput /></td>
            <td></td>
          </tr>
        </tbody>


        <!--Nicehash API-->
        <thead (click)="isNicehashApiKeysToggled = !isNicehashApiKeysToggled; getNicehashApiKeys()">
          <tr>
            <th><span class="helperSpanTitle" title="These API Keys enable Nicehash support. A system for mining cryptocurrency."></span></th>
            <th>Nicehash API Keys</th>
            <th style="text-align:right;">
              <button (click)="updateNHAPIKeys()" title="Update settings" [disabled]="!isNicehashApiKeysToggled" *ngIf="isNicehashApiKeysToggled">üîÑ</button>
            </th>
          </tr>
        </thead>
        <tbody *ngIf="isNicehashApiKeysToggled">
          <tr>
            <td></td>
            <td>OrgId:</td>
            <td><input type="text" placeholder="Org Id" #orgId [value]="nhApiKeys?.orgId ?? ''" /></td>
          </tr>
          <tr>
            <td></td>
            <td>ApiKey:</td>
            <td><input type="text" placeholder="API Key" #apiKey [value]="nhApiKeys?.apiKey ?? ''" /></td>
          </tr>
          <tr>
            <td></td>
            <td>ApiSecret:</td>
            <td><input type="text" placeholder="API Secret" #apiSecret [value]="nhApiKeys?.apiSecret ?? ''" /></td>
          </tr>
        </tbody>
      </table>
      <button (click)="parentRef?.createComponent('User');">Close</button>
    </fieldset>
  </div>
</div> 
