<div class="wordler-high-scores">
    <div *ngIf="loading">Loading scores...</div>
    <div *ngIf="error" class="error">{{ error }}</div>

    <div *ngIf="!loading && !error">
         <ng-container *ngIf="modesSelected.length; else noScores">
            <div *ngFor="let m of modesSelected" class="mode-section">
                <div *ngIf="showHeader"
                    (click)="showUserHeader ? (openWordler()) : toggleMode(m)"
                    [class]="(showUserHeader ? 'popupPanelTitle userPopupPanelTitle clickable' : (showHeaderTitles ? 'popupPanelTitle clickable' : 'regularTitle clickable'))"
                    [style.marginTop]="'15px'">
                    {{ headerTitle ? headerTitle : (m === 'today' ? "Today's Wordler Scores:" : (m === 'user' ? "Your Wordler Scores:" : (m === 'best' ? 'Best Scores (All Time):' : "All-time Wordler Scores:"))) }}
                    <span *ngIf="!showUserHeader" style="float:right; font-size:0.9em">{{ isModeCollapsed(m) ? '+' : '−' }}</span>
                </div>
                <ng-container *ngIf="!isModeCollapsed(m)">
                    <ng-container *ngIf="groupedByMode[m] && (keys(groupedByMode[m]).length > 0); else emptyMode">
                        <div *ngFor="let group of groupedByMode[m] | keyvalue: keepOrder" class="difficulty-group">
                            <h4 (click)="toggleGroup(m, group.key)" [class]="showUserHeader ? 'userPopupPanelTitle' : ''">
                                {{ m === 'best' && +group.key === 999 ? 'Best (All Time)' : difficultyLabel(+group.key) }} ({{ group.value.length || 0 }})
                                <span *ngIf="!showUserHeader" style="float:right; font-size:0.9em">{{ isGroupCollapsed(m, group.key) ? '+' : '−' }}</span>
                            </h4>
                            <table class="mainTable" *ngIf="!isGroupCollapsed(m, group.key)">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>User</th>
                                        <th>Score</th>
                                        <th>Time (s)</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let s of group.value; let i = index">
                                        <td>{{ i + 1 }}</td>
                                        <td>
                                            <app-user-tag [user]="s.user" [displayMiniTag]="true" [displayHoverPicture]="true" [inputtedParentRef]="inputtedParentRef"></app-user-tag>
                                        </td>
                                        <td>{{ s.score }}</td>
                                        <td>{{ s.time }}</td>
                                        <td>{{ s.submitted ? (s.submitted | timeSince) : '-' }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </ng-container>
                </ng-container>
                <ng-template #emptyMode>
                    <div class="no-scores">
                        No{{" "}}
                        <app-menu-item 
                        style="display: inline-block;"
                        [type]="'Wordler'" 
                        [parentRef]="inputtedParentRef"></app-menu-item>
                        {{" "}}scores to show for {{ m }}.
                    </div>
                </ng-template>
            </div>
        </ng-container>

        <ng-template #noScores>
            <div class="no-scores">No scores to show.</div>
        </ng-template>
    </div>
</div>