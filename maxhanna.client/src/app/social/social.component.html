<div class="componentMain" #componentMain>
  <div *ngIf="!user">
    <div class="closeButton" (click)="remove_me('SocialComponent');"></div>
    <div class="refreshButton" (click)="ngOnInit();"></div>
    <div class="componentTitle">Social</div>
  </div>
  <div *ngFor="let notif of notifications" [innerHTML]="notif" class="notification" (click)="notifications = []"></div>

  <div *ngIf="showTopicSelector">
    <app-topics #topicComponent
                [isDropdown]="true"
                [user]="parentRef?.user"
                [parent]="parent ?? parentRef"
                (topicAdded)="onTopicAdded($event)"> 
    </app-topics>    
  </div>
  <div class="storyInputDiv">
    <textarea #story
              placeholder="Whats on your mind ?"
              class="foodForThought" 
              (focus)="focusInput()"></textarea>
    <div class="mainFileUploaderAndTopicSelectorDiv">
      <button (click)="post()">üó®Ô∏è Post</button>

      <app-media-selector #postMediaSelector
                          [currentDirectory]="parentRef?.user?.username ? 'Users/' + parentRef!.user!.username! : user?.username ? 'Users/' + user!.username! :  'Users/Anonymous'"
                          [user]="parentRef?.user"
                          (selectFileEvent)="selectFile($event)"></app-media-selector> 
    </div>
    <div *ngIf="attachedFiles.length > 0">
      {{attachedFiles.length}} Attached Files:
      <div *ngFor="let file of attachedFiles">
        {{file.fileName}}
        <button (click)="removeAttachment(file.id)" title="Remove attachment">‚ùå</button> 
      </div>
    </div>
  </div>
  <div class="inputDiv searchInputs">
    <div class="pagination" *ngIf="totalPagesArray.length > 1">
      <span>Page:</span>
      <select [value]="currentPage" (change)="pageChanged()" #pageSelect>
        <option *ngFor="let page of totalPagesArray" [value]="page">{{ page }}</option>
      </select>
    </div>
    <div>
      <input type="text" #search placeholder="Search the socials" (keyup.enter)="searchStories()" *ngIf="!user" />
      <input type="submit" (click)="searchStories()" class="createStoryButton" value="üîç" *ngIf="!user" />
    </div>
  </div>

  <div class="mainTableDiv" id="mainTableDiv">
    <div *ngFor="let story of storyResponse?.stories" [id]="'storyDiv'+story.id" class="storyContainer">
      <div class="commentVoteButtons">
        <button (click)="copyLink(story.id!)" *ngIf="!user" title="Share Link" style="display:inline-block">üìãShare</button>
        <button (click)="delete(story)" *ngIf="story.user?.id == parentRef?.user?.id || user?.id == parentRef?.user?.id" title="Share Link" style="display:inline-block">‚ùåDelete</button>
      </div>
      <div class="storyTextContainer">
        <div class="avatarDiv">
          <div class="usernameProfileLink">
            <app-user-tag [user]="story.user" [inputtedParentRef]="parentRef ?? parent"></app-user-tag>
          </div>
          <div class="storyDate">
            <div class="datePart">
              {{ story.date?.toString()?.split('T') ? story.date?.toString()!.split('T')[0] : '' }}
            </div>
            <div class="timePart">
              {{ story.date?.toString()!.split('T').length > 0 ? story.date?.toString()!.split('T')[1] : '' }}
            </div>
          </div>
        </div>
        <div class="storyContentDiv">
          <div class="storyUserDetails">
            <div class="storyText" [class]="'hidden'" [innerHtml]="createClickableUrls(story.storyText)"></div>
            <app-reaction [storyId]="story.id"
                          [user]="parentRef?.user"
                          [currentReactions]="story.reactions"></app-reaction>
          </div>
          <div class="storyTopics" *ngIf="story.storyTopics && story.storyTopics.length > 0">
            Topics : <span *ngFor="let topic of story.storyTopics" class="chosenTopic" (click)="topicComponent.selectTopic(topic)">{{topic.topicText}}</span>
          </div>
          <div *ngIf="story.storyFiles && story.storyFiles.length > 0">
            <div class="italics attachmentTdTitle">Attachments:</div>
            <div *ngFor="let file of story.storyFiles" class="attachment">
              <app-media-viewer [user]="file.user"
                                [inputtedParentRef]="parentRef"
                                [currentDirectory]="file.directory"
                                [file]="file"
                                [showCommentSection]="false"
                                [displayExtraInfo]="false"
                                [displayExpander]="true"
                                [autoplay]="true"
                                [autoload]="false">
              </app-media-viewer>
            </div>
          </div>
          <div *ngIf="story.metadata">
            <div *ngIf="story.metadata.title" class="metadataTitle">{{story.metadata.title}}</div>
            <div *ngIf="story.metadata.description" class="metadataDescription" [innerHtml]="createClickableUrls(story?.metadata?.description)"></div>
            <div *ngIf="story.metadata.imageUrl" (click)="goToLink(story)" class="cursorPointer"><img class="metadataImage" [src]="story?.metadata?.imageUrl" /></div>
          </div>
        </div>

      </div>
      <app-comments *ngIf="story"
                    [inputtedParentRef]="parentRef"
                    [type]="'Social'"
                    [component_id]="story.id!"
                    [commentList]="story!.storyComments!">
      </app-comments>
    </div>
  </div>
</div>
